<script src="https://www.google.com/recaptcha/enterprise.js?render={{ public_key }}{% if api_params %}&{{ api_params }}{% endif %}"></script>
<script type="text/javascript">
    var element
    grecaptcha.enterprise.ready(function() {
        element = document.querySelector('.g-recaptcha[data-widget-uuid="{{ widget_uuid }}"]');
        element.form.addEventListener('submit', recaptchaFormSubmit);
    });
    function recaptchaFormSubmit(event) {
        event.preventDefault();

        var action = element.getAttribute('data-action');
        if (!action) {
            action = 'form'
        }
        grecaptcha.enterprise.execute('{{ public_key }}', {action: action})
        .then(function(token) {
            console.log("reCAPTCHA validated for 'data-widget-uuid=\"{{ widget_uuid }}\"'. Setting input value...")
            element.value = token;
            element.form.submit();

            // IMPORTANT: The 'token' that results from execute is an encrypted response sent by
            // reCAPTCHA Enterprise to the end user's browser.
            // This token must be validated by creating an assessment.
             // See https://cloud.google.com/recaptcha-enterprise/docs/create-assessment
        });
    }
</script>